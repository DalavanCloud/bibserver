{% extends "base.html" %}

{% block content %}

{% if admin %}

    <div class="hero-unit clearfix">
        <div class="span5">
            <h2>Hi {{ current_user.id }}</h2>
            <p>{{ current_user.description }}</p>
            {% if current_user.is_super %}
                <p>You are the superuser! You can view and edit anything!</p>
            {% endif %}
        </div>
        <div id="user" class="span5">
            <div class="btn-group" style="margin-bottom:20px;">
                <a class="btn btn-large" href="/{{ account.id }}/collections">View all your collections</a>
                <a class="btn btn-large btn-danger" href="{{ url_for('account.logout') }}">Logout</a>
            </div>
            <small>Your api_key is {{account['api_key']}} <br>
            <a href="http://bibserver.readthedocs.org/en/latest/api.html">Check out the docs</a> to learn more.</small>
        </div>
    </div>

    <div class="row-fluid">
        {% if current_user.recentsearches|length != 0 %}
            <div class="span6">
                <table class="table table-striped table-bordered">
                <tr><td><h3>Your recent search terms</h3></td></tr>
                {% for search in current_user.recentsearches %}
                    {% if 'query_string' in search.query.query %}
                        {% if 'query' in search.query.query.query_string %}
                            <tr><td><a href="/search?source={{ search.querystring }}">{{ search.query.query.query_string.query }}</a> 
                            {% if 'bool' in search.query.query %}
                                ( plus some filters ) 
                            {% endif %}
                             - {{ search.resultsize }} results at the time</td></tr>
                        {% endif %}
                    {% endif %}
                {% endfor %}
                </table>
            </div>
        {% endif %}
        {% if current_user.recentviews|length != 0 %}
            <div class="span6">
                <table class="table table-striped table-bordered">
                <tr><td><h3>Your recently viewed records</h3></td></tr>
                {% for view in current_user.recentviews %}
                    <tr><td><a href="/record/{{ view[0] }}">{{ view[1] }}</a></td></tr>
                {% endfor %}
                </table>
            </div>
        {% endif %}
    </div>

{% else %}

    <div class="hero-unit clearfix">
        <div class="span5">
            <h2>{{ account.id }}</h2>
            <p>{{ account.description }}</p>
        </div>
        <div class="span5">
            <p><a class="btn" href="/{{ account.id }}/collections">View collections</a></p>
        </div>
    </div>
    
{% endif %}

{% endblock %}

